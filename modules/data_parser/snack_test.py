#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
κ³Όμ λ°μ΄ν„° νμ‹± λ° μΉ΄λ“ μƒμ„± ν…μ¤νΈ
"""

from universal_smart_parser import UniversalSmartParser
from card_generator import CardGenerator

# νκ΄‘λ‹μ΄ μ κ³µν• κ³Όμ λ°μ΄ν„°
snack_data = """
λ‰΄νΈλ¦¬μ¤μ½” μ΄μ½λ¦Ώλ§› μ›¨μ΄νΌ, 12g, 30κ°
λ‰΄νΈλ¦¬μ¤μ½” μ΄μ½λ¦Ώλ§› μ›¨μ΄νΌ, 12g, 30κ°
29%7,800μ›
5,500μ›
λ΅μΌ“λ°°μ†΅
(10gλ‹Ή 153μ›)
λ‚΄μΌ(λ©) λ„μ°© λ³΄μ¥
5
(3109)
μµλ€ 275μ› μ λ¦½
μµλ€ 275μ› μ λ¦½
1
λ‰΄νΈλ¦¬μ¤μ½” λ°€ν¬λ§› μ›¨μ΄νΌ, 360g, 1κ°
μΏ ν΅μ¶”μ²
λ‰΄νΈλ¦¬μ¤μ½” λ°€ν¬λ§› μ›¨μ΄νΌ, 360g, 1κ°
29%7,800μ›
5,500μ›
λ΅μΌ“λ°°μ†΅
(10gλ‹Ή 153μ›)
λ‚΄μΌ(λ©) λ„μ°© λ³΄μ¥
5
(3568)
μµλ€ 275μ› μ λ¦½
μµλ€ 275μ› μ λ¦½
2
λ§μΌ“μ¤ λΈλΌμ°λ‹ μ μ£Όλ§μ°¨ 12κ°μ…, 240g, 1κ°
λ§μΌ“μ¤ λΈλΌμ°λ‹ μ μ£Όλ§μ°¨ 12κ°μ…, 240g, 1κ°
5%5,280μ›
5,010μ›
λ΅μΌ“λ°°μ†΅
(10gλ‹Ή 209μ›)
λ‚΄μΌ(λ©) λ„μ°© λ³΄μ¥
5
(3254)
μµλ€ 250μ› μ λ¦½
μµλ€ 250μ› μ λ¦½
3
κµ¬μ΄κΉ€ λ‹¬μ½¤ μ€κ³Όμ, 1κ°, 900g
κµ¬μ΄κΉ€ λ‹¬μ½¤ μ€κ³Όμ, 1κ°, 900g
8,770μ›
λ΅μΌ“λ°°μ†΅
(10gλ‹Ή 97μ›)
λ‚΄μΌ(λ©) λ„μ°© λ³΄μ¥
5
(661)
μµλ€ 439μ› μ λ¦½
μµλ€ 439μ› μ λ¦½
AD
μ¤λ¦¬μ¨ μ™€μ°μ¤λ‚µ μ„ λ¬Όμ„ΈνΈ 16ν©, ν¬μΉ΄μΉ© + κΌ¬λ¶μΉ© + μ¤κ°μ + λμ•„μ¨μ¬μΉ©, 1μ„ΈνΈ
μ¤λ¦¬μ¨ μ™€μ°μ¤λ‚µ μ„ λ¬Όμ„ΈνΈ 16ν©, ν¬μΉ΄μΉ© + κΌ¬λ¶μΉ© + μ¤κ°μ + λμ•„μ¨μ¬μΉ©, 1μ„ΈνΈ
12%11,800μ›
10,320μ›
λ΅μΌ“λ°°μ†΅
(1μ„ΈνΈλ‹Ή 10,320μ›)
λ‚΄μΌ(λ©) λ„μ°© λ³΄μ¥
5
(18149)
μµλ€ 516μ› μ λ¦½
μµλ€ 516μ› μ λ¦½
4
[μ¤λ‚µ365] κ°κΏ€λ§› 10μΆ… ν¬μΉ΄μΉ© κΌ¬λ¶μΉ© μ½μΉ© κΌ¬κΉ”μ½ μΉν† μ¤ μ¤λ‚µ κ³Όμμ„ΈνΈ, 1κ°
[μ¤λ‚µ365] κ°κΏ€λ§› 10μΆ… ν¬μΉ΄μΉ© κΌ¬λ¶μΉ© μ½μΉ© κΌ¬κΉ”μ½ μΉν† μ¤ μ¤λ‚µ κ³Όμμ„ΈνΈ, 1κ°
13,800μ›
λ΅μΌ“λ°°μ†΅
(1μ„ΈνΈλ‹Ή 13,800μ›)
λ‚΄μΌ(λ©) λ„μ°© λ³΄μ¥
4.5
(2194)
μµλ€ 690μ› μ λ¦½
μµλ€ 690μ› μ λ¦½
5
λ†μ‹¬ κ³Όμ μ„ΈνΈ, κ³Όμ 5μΆ…, 1μ„ΈνΈ
λ†μ‹¬ κ³Όμ μ„ΈνΈ, κ³Όμ 5μΆ…, 1μ„ΈνΈ
8%15,910μ›
14,500μ›
λ΅μΌ“λ°°μ†΅
(1μ„ΈνΈλ‹Ή 14,500μ›)
λ‚΄μΌ(λ©) λ„μ°© λ³΄μ¥
5
(3334)
μµλ€ 725μ› μ λ¦½
μµλ€ 725μ› μ λ¦½
AD
λ°°μ¤ν‚¨λΌλΉμ¤ μ«€λ–΅κ¶ν•© νμ΄, 264g, 3κ°
λ°°μ¤ν‚¨λΌλΉμ¤ μ«€λ–΅κ¶ν•© νμ΄, 264g, 3κ°
μΏ ν°ν• μΈ37%15,840μ›
9,900μ›
λ΅μΌ“λ°°μ†΅
(10gλ‹Ή 125μ›)
λ‚΄μΌ(λ©) λ„μ°© λ³΄μ¥
5
(673)
μµλ€ 495μ› μ λ¦½
μµλ€ 495μ› μ λ¦½
6
λ΅―λ°μ›°ν‘Έλ“ μΉ™μ΄‰, 168g, 2κ°
λ΅―λ°μ›°ν‘Έλ“ μΉ™μ΄‰, 168g, 2κ°
42%9,600μ›
5,500μ›
λ΅μΌ“λ°°μ†΅
(10gλ‹Ή 164μ›)
λ‚΄μΌ(λ©) λ„μ°© λ³΄μ¥
5
(43416)
μµλ€ 275μ› μ λ¦½
μµλ€ 275μ› μ λ¦½
7
μ¤λ¦¬μ¨ μ½¤λ³΄ μ΄μ½”νμ΄ μ • 39g x 12p + μΉ΄μ¤νƒ€λ“ 23g x 12p, 744g, 1κ°
μ¤λ¦¬μ¨ μ½¤λ³΄ μ΄μ½”νμ΄ μ • 39g x 12p + μΉ΄μ¤νƒ€λ“ 23g x 12p, 744g, 1κ°
36%12,750μ›
8,050μ›
λ΅μΌ“λ°°μ†΅
(10gλ‹Ή 108μ›)
λ‚΄μΌ(λ©) λ„μ°© λ³΄μ¥
5
(29727)
μµλ€ 403μ› μ λ¦½
μµλ€ 403μ› μ λ¦½
8
ν•΄νƒμ κ³Ό μ‚¬λΈλ  μ΄μ½”ν¬λ , 204g, 1κ°
ν•΄νƒμ κ³Ό μ‚¬λΈλ  μ΄μ½”ν¬λ , 204g, 1κ°
25%4,600μ›
3,450μ›
λ΅μΌ“λ°°μ†΅
(10gλ‹Ή 169μ›)
λ‚΄μΌ(λ©) λ„μ°© λ³΄μ¥
5
(973)
μµλ€ 173μ› μ λ¦½
μµλ€ 173μ› μ λ¦½
9
λ†μ‹¬ λ©”λ΅ ν‚¥, 60g, 1κ°
λ†μ‹¬ λ©”λ΅ ν‚¥, 60g, 1κ°
ν• μΈ52%2,500μ›
1,200μ›
(10gλ‹Ή 200μ›)
λ°°μ†΅λΉ„ 2,500μ›
λ¨λ (κΈ) λ„μ°© μμ •
5
(2526)
μµλ€ 60μ› μ λ¦½
μµλ€ 60μ› μ λ¦½
10
"""

def main():
    """κ³Όμ λ°μ΄ν„° νμ‹± λ° μΉ΄λ“ μƒμ„±"""
    print("π κ³Όμ λ°μ΄ν„° νμ‹± λ° μΉ΄λ“ μƒμ„± ν…μ¤νΈ")
    print("=" * 60)
    
    # 1. λ°μ΄ν„° νμ‹±
    parser = UniversalSmartParser()
    products = parser.parse_coupang_data(snack_data, category='snack')
    
    if not products:
        print("β νμ‹± μ‹¤ν¨")
        return
    
    print(f"β… {len(products)}κ° κ³Όμ μƒν’ νμ‹± μ™„λ£!")
    
    # 2. μΉ΄λ“ μƒμ„±
    card_generator = CardGenerator()
    
    # μ„μ‹ JSON νμΌ μƒμ„±
    temp_json = {
        'meta': {
            'title': 'μΏ ν΅ κ³Όμ μμ„',
            'total_products': len(products),
            'category': 'snack'
        },
        'products': products
    }
    
    # JSON νμΌ μ €μ¥
    import json
    temp_file = "temp_snack_data.json"
    with open(temp_file, 'w', encoding='utf-8') as f:
        json.dump(temp_json, f, ensure_ascii=False, indent=2)
    
    # μΉ΄λ“ μƒμ„±
    cards = card_generator.generate_cards_from_json(temp_file)
    
    if cards:
        # μΉ΄λ“ λ―Έλ¦¬λ³΄κΈ°
        card_generator.preview_cards(cards)
        
        # JSON μ €μ¥
        json_file = card_generator.save_cards_to_json(cards, "snack_cards_20250709.json")
        
        # HTML λ―Έλ¦¬λ³΄κΈ° μƒμ„±
        html_file = card_generator.generate_html_preview(cards, "snack_cards_preview_20250709.html")
        
        print(f"\nπ‰ κ³Όμ μΉ΄λ“ μƒμ„± μ™„λ£!")
        print(f"π“„ JSON νμΌ: {json_file}")
        print(f"π HTML λ―Έλ¦¬λ³΄κΈ°: {html_file}")
        print(f"π― {len(cards)}κ° κ³Όμ μΉ΄λ“κ°€ WhatToEat λ£°λ ›μ— μ‚¬μ© κ°€λ¥ν•©λ‹λ‹¤!")
        
        # ν†µκ³„ μ •λ³΄
        print(f"\nπ“ κ³Όμ μΉ΄λ“ ν†µκ³„:")
        print(f"   β€Ά μ΄ μΉ΄λ“ μ: {len(cards)}κ°")
        print(f"   β€Ά κ°€κ²© λ²”μ„: {min(c.price_numeric for c in cards):,}μ› ~ {max(c.price_numeric for c in cards):,}μ›")
        print(f"   β€Ά ν• μΈ μƒν’: {len([c for c in cards if c.discount])}κ°")
        print(f"   β€Ά ν‰κ·  ν‰μ : {sum(c.rating for c in cards) / len(cards):.1f}μ ")
        
        # μΉ΄ν…κ³ λ¦¬λ³„ λ¶„λ¥
        brands = {}
        for card in cards:
            brand = card.title.split()[0]
            brands[brand] = brands.get(brand, 0) + 1
        
        print(f"   β€Ά λΈλλ“λ³„ λ¶„ν¬:")
        for brand, count in sorted(brands.items(), key=lambda x: x[1], reverse=True):
            print(f"     - {brand}: {count}κ°")
            
    else:
        print("β μΉ΄λ“ μƒμ„± μ‹¤ν¨")

if __name__ == "__main__":
    main()